---
title: "PSI_Capstone Pair Project"
author: "Ruei Li Jhang & Chia Hua Lin"
date: "2024-03-25"
output: 
  html_document:
    toc: yes
    toc_depth: 5
    number_sections: yes
    theme: united
    highlight: tango
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
rm(list = ls())
```


```{r message=FALSE, warning=FALSE}

# Loading libraries

library(dplyr)
library(ggplot2)
library(ltm)
library(randomForest)
library(rpart)


```



# Data Understanding

The data set was downloaded from Kaggle.com. According to the data description, the data focuses on malicious URL detection. This data helps in the development of cyber security systems that can detect any malicious attempt to gain access and send a sigal to systems to perform the relevant in return.

Data set link: https://www.kaggle.com/datasets/pilarpieiro/tabular-dataset-ready-for-malicious-url-detection/data

The data set includes URLs and 60 other calculated features. In our analysis, we will not use all the 60 features, but we will select the most important features. In the data description, a list of 9 important features has been provided and they are as follows:

* Basic URL Components

* Domain Information

* Content Analysis

* Host Reputation

* Network Features

* Behavioural Features



```{r}

# # Loading the train data
# train_data <- read.csv('train_dataset.csv')
# train_data <- na.omit(train_data) # Remove rows with any NA/null values
# dim(train_data)
 
# # Loading test data
# test_data <- read.csv('test_dataset.csv')
# test_data <- na.omit(test_data) # Remove rows with any NA/null values
# dim(test_data)

```

The original train data has 6,728,848 observations and the test data contains 1,682,213.


**Due to the computational resources, we will randomly select 200,000 observations for training and 100,000 observations for testing.** 



```{r}

# # Set seed for reproducibility
# set.seed(2024)

# # Define the number of samples you want for each label category
# num_samples_per_label <- 1000000

# # Sample from each label category
# train_data_sample <- train_data %>%
#    group_by(label) %>%
#    sample_n(num_samples_per_label, replace = TRUE)

# # Test data
# test_data_sample <- test_data[sample(nrow(test_data), 1000000), ]

# # Write train_data2 to CSV
# write.csv(train_data_sample, file = "train_data_sample.csv", row.names = FALSE)
# write.csv(test_data_sample, file = "test_data_sample.csv", row.names = FALSE)

```




## Loading the Save Data

```{r}

# Loading the train data
train_data <- read.csv('train_data_sample.csv')
train_data <- na.omit(train_data) # Remove rows with any NA/null values
dim(train_data)

# Loading the test data
test_data <- read.csv('test_data_sample.csv')
test_data <- na.omit(test_data) # Remove rows with any NA/null values
dim(test_data)

```




## Selecting Necessary Columns

We selected specific columns from the train_data data frame. The columns selected include various features related to URLs as:

* Whether the URL contains certain elements like login, client, server, admin, IP,
* Whether it is shortened,
* Its length, entropy,
* Its counts of various characters and components,
* Features related to the length
* Components of the path,
* Query, sub domain, and primary domain of the URL.
* Label column indicating some classification or labeling information associated with each URL.


```{r}

# Train data
train_data <- train_data %>%
  dplyr::select(url, source, url_has_login, url_has_client, url_has_server,
                url_has_admin, url_has_ip, url_isshorted, url_len, 
                url_entropy, url_count_dot, url_count_https, url_count_http,
                url_count_perc, url_count_hyphen, url_count_www,
                url_count_hash, url_count_semicolon, url_count_underscore, 
                url_count_ques, url_count_equal, url_count_amp,
                url_count_letter, url_count_digit,
                url_count_sensitive_financial_words, 
                url_count_sensitive_words, path_len, query_len, 
                query_count_components, pdomain_len, subdomain_len, 
                subdomain_count_dot, label
                )

```











